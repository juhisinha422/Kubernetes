Kubernetes Tip âœ : Simplifying Ingress Routing using Ingress Annotations

K8s Ingress annotations are key-value pairs added to the metadata of an ingress resource. They allow to customize behavior when using specific Ingress controllers like NGINX, HAProxy, etc....

Some of the commonly used NGINX Ingress annotations are:
âž¡ï¸ rewrite-target: Target URI where the traffic must be redirected.
âž¡ï¸ use-regex: Indicates if the paths defined on an ingress use regular expressions.
âž¡ï¸ ssl-redirect & force-ssl-redirect: Secure the endpoints with auto HTTPS redirects
âž¡ï¸ proxy-body-size: Handle large file uploads gracefully

Use Case ðŸ—’ï¸ : API Gateway Routing in Kubernetes
 
Suppose we have a backend service (user-service) running inside k8s. The goal is to :
1ï¸âƒ£ Route incoming traffic from /api/users/... to this service
2ï¸âƒ£ Strip the /api prefix before forwarding(rewrite the path)
2ï¸âƒ£ Enforce HTTPS redirection
4ï¸âƒ£ Support large file uploads

#annotation.yaml file
.....
annotations:
 nginx.ingress.kubernetes[.]io/rewrite-target: /$1
 nginx.ingress.kubernetes[.]io/use-regex: "true"
 nginx.ingress.kubernetes[.]io/ssl-redirect: "true"
 nginx.ingress.kubernetes[.]io/proxy-body-size: "50m"
.....
Explanation ðŸ‘‡ :
ðŸ”¸rewrite-target: /$1 -> rewrites /api/users/profile -> /users/profile
ðŸ”¸use-regex: "true" -> allow path pattern matching
ðŸ”¸ssl-redirect: "true" -> automatically redirects to HTTPS
ðŸ”¸proxy-body-size: "50m" -> enables large uploads without a error
